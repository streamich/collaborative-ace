"use strict";(self.webpackChunkcollaborative_ace=self.webpackChunkcollaborative_ace||[]).push([[141],{"./src/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,__namedExportsOrder:()=>__namedExportsOrder,default:()=>index_stories});var react=__webpack_require__("./node_modules/react/index.js"),json_crdt=__webpack_require__("./node_modules/json-joy/lib/json-crdt/index.js"),lib=__webpack_require__("./node_modules/react-ace/lib/index.js"),collaborative_editor_lib=__webpack_require__("./node_modules/collaborative-editor/lib/index.js");class AceEditorFacade{constructor(editor){this.editor=editor,editor.on("change",this.onChange)}onChange=delta=>{if(delta&&"object"==typeof delta&&delta.start&&delta.end){const start=this.editor.session.doc.positionToIndex(delta.start),text=delta.lines.join("\n");switch(delta.action){case"insert":this.onchange?.([[start,0,text]]);break;case"remove":this.onchange?.([[start,text.length,""]]);break;default:this.onchange?.()}}else this.onchange?.()};get(){return this.editor.getValue()}getLength(){const doc=this.editor.session.doc,nl=doc.getNewLineCharacter().length,lines=doc.getAllLines();let length=0;for(let i=0;i<lines.length;i++)length+=lines[i].length+nl;return length-=nl,length}set(text){this.editor.setValue(text)}ins(pos,text){const session=this.editor.session,position=session.doc.indexToPosition(pos,0);session.insert(position,text)}del(pos,len){const session=this.editor.session,doc=session.doc,R=session.selection.getRange().constructor,start=doc.indexToPosition(pos,0),end=doc.indexToPosition(pos+len,0),range=new R(start.row,start.column,end.row,end.column);session.remove(range)}dispose(){this.editor.off("change",this.onChange)}}function _extends(){return _extends=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_extends.apply(null,arguments)}const CollaborativeAce=_ref=>{let{str,polling,onLoad,...rest}=_ref;const unbindRef=react.useRef(null),editorRef=react.useRef(null);react.useEffect((()=>()=>{unbindRef.current?.()}),[]);return react.createElement(lib.Ay,_extends({},rest,{value:str().view(),onLoad:editor=>{editorRef.current=editor,unbindRef.current=((str,editor,polling)=>collaborative_editor_lib.StrBinding.bind(str,new AceEditorFacade(editor),polling))(str,editor,!!polling),onLoad?.(editor)}}))};try{CollaborativeAce.displayName="CollaborativeAce",CollaborativeAce.__docgenInfo={description:"",displayName:"CollaborativeAce",props:{str:{defaultValue:null,description:"",name:"str",required:!0,type:{name:"() => CollaborativeStr"}},polling:{defaultValue:null,description:"",name:"polling",required:!1,type:{name:"boolean"}},onLoad:{defaultValue:null,description:"",name:"onLoad",required:!1,type:{name:"((editor: Editor) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/CollaborativeAce.tsx#CollaborativeAce"]={docgenInfo:CollaborativeAce.__docgenInfo,name:"CollaborativeAce",path:"src/CollaborativeAce.tsx#CollaborativeAce"})}catch(__react_docgen_typescript_loader_error){}const index_stories={title:"CodeMirror Editor",component:({src=""})=>{const editorRef=react.useRef(null),[model,clone]=react.useMemo((()=>{const model=json_crdt.Model.create();return model.api.root(src),[model,model.clone()]}),[src]);react.useSyncExternalStore(model.api.subscribe,(()=>model.tick));return react.createElement("div",null,react.createElement(CollaborativeAce,{str:()=>model.api.str([]),onLoad:editor=>{editorRef.current=editor},style:{border:"1px solid #aaa"}}),react.createElement("div",null,react.createElement("button",{type:"button",onClick:()=>((text,position)=>{const editor=editorRef.current;if(!editor)return;const session=editor.session,doc=session.doc,pos=position??editor.getValue().length,docPos=doc.indexToPosition(pos,0);session.insert(docPos,text)})("!")},'Append "!" to editor')),react.createElement("div",null,react.createElement("button",{type:"button",onClick:()=>setTimeout((()=>{const str=model.api.str([]);str.ins(str.length(),"?")}),2e3)},'Append "?" to model after 2s')),react.createElement("div",null,react.createElement("button",{type:"button",onClick:()=>setTimeout((()=>{const ace=editorRef.current;if(!ace)return;const pos=ace.session.doc.indexToPosition(ace.getValue().length,0);ace.session.insert(pos,"!")}),2e3)},'Append "!" to editor after 2s')),react.createElement("div",null,react.createElement("button",{type:"button",onClick:()=>setTimeout((()=>{model.api.str([]).ins(0,"1. ")}),2e3)},'Prepend "1. " to model after 2s')),react.createElement("div",null,react.createElement("button",{type:"button",onClick:()=>{setTimeout((()=>{model.reset(clone)}),2e3)}},"RESET after 2s")),react.createElement("div",null,react.createElement("button",{type:"button",onClick:()=>{setTimeout((()=>{model.api.str([]).del(0,1)}),2e3)}},"Delete model first char after 2s")),react.createElement("pre",{style:{fontSize:"10px"}},react.createElement("code",null,model.root+"")))},argTypes:{}},Primary={args:{src:"gl"}},__namedExportsOrder=["Primary"];Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:"{\n  args: {\n    src: 'gl'\n  }\n}",...Primary.parameters?.docs?.source}}}}}]);